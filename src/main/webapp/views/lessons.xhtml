<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
>
    <h:form id="lessonsForm">
        <p:panelGrid columns="9" styleClass="noBorder">
            <p:outputLabel for="dateFrom" value="#{msg['lesson.dateFrom']}"/>
            <p:calendar id="dateFrom" value="#{lessonsBean.dateFrom}"
                        converter="localDateConverter" pattern="dd.MM.yyyy">
            </p:calendar>
            <p:outputLabel for="dateTo" value="#{msg['lesson.dateTo']}"/>
            <p:calendar id="dateTo" value="#{lessonsBean.dateTo}"
                        converter="localDateConverter" pattern="dd.MM.yyyy">
            </p:calendar>

            <p:selectBooleanCheckbox id="showClosed" value="#{lessonsBean.showClosed}"/>
            <p:outputLabel for="showClosed" value="#{msg['label.showClosed']}"/>

            <p:outputLabel for="stream" value="#{msg['lesson.stream']}"/>
            <p:selectOneMenu id="stream" value="#{lessonsBean.streamId}">
                <f:selectItem itemValue="#{null}" itemLabel="#{msg['select.stream']}"/>
                <f:selectItems value="#{lessonsBean.streams}" var="stream"
                               itemLabel="#{stream.value}" itemValue="#{stream.key}"/>
            </p:selectOneMenu>

            <p:commandButton value="#{msg['btn.search']}" icon="fa fa-fw fa-search"
                             actionListener="#{lessonsBean.search}"
                             update=":lessonsForm"/>
        </p:panelGrid>

        <p:dataTable id="lessons"
                     var="lesson"
                     value="#{lessonsBean.lessons}"
                     selection="#{lessonsBean.selectedLesson}"
                     rowKey="#{lesson.id}"
                     selectionMode="single"
                     sortBy="#{lesson.date}"
                     sortOrder="descending"
                     filteredValue="#{lessonsBean.filteredLessons}"
                     emptyMessage="#{msg['label.emptyMessage']}">
            <p:ajax event="filter" update="@this"/>
            <!--<p:ajax event="rowSelect" listener="#{registrationModeBean.initLesson(lessonsBean.selectedLesson)}"-->
            <!--update="@([id$=wrapper])">-->
            <!--<f:setPropertyActionListener value="#{false}" target="#{menuBean.showMenu}"/>-->
            <!--<f:setPropertyActionListener value="registrationMode" target="#{sessionBean.activeView}"/>-->
            <!--</p:ajax>-->

            <p:column headerText="#{msg['lesson.stream']}"
                      sortBy="#{lesson.stream.name}"
                      filterBy="#{lesson.stream.name}"
                      filterMatchMode="startsWith"
            >
                <h:outputText value="#{lesson.stream.name}"/>
            </p:column>
            <p:column headerText="#{msg['lesson.discipline']}"
                      sortBy="#{lesson.stream.discipline.name}"
                      filterBy="#{lesson.stream.discipline.name}"
                      filterMatchMode="startsWith"
            >
                <h:outputText value="#{lesson.stream.discipline.name}"/>
            </p:column>
            <p:column headerText="#{msg['lesson.date']}"
                      sortBy="#{lesson.date}"
                      filterBy="#{lesson.date}"
                      filterMatchMode="startsWith"
            >
                <h:outputText value="#{lesson.date}" converter="localDateConverter"/>
            </p:column>
            <p:column headerText="#{msg['lesson.time']}"
                      sortBy="#{lesson.schedule.caption}"
                      filterBy="#{lesson.schedule.caption}"
                      filterMatchMode="contains"
            >
                <h:outputText
                    value="#{lesson.schedule ne null ? lesson.schedule.caption : ''}"/>
            </p:column>
            <p:column headerText="#{msg['lesson.type']}"
                      sortBy="#{msg[lesson.type.key]}"
                      filterBy="#{msg[lesson.type.key]}"
                      filterMatchMode="startsWith"
                      styleClass="#{(lesson.type eq 'PRACTICAL' or lesson.type eq 'LAB') ? 'blue' : ''}"
            >
                <h:outputText value="#{msg[lesson.type.key]}"/>
            </p:column>
            <p:column headerText="#{msg['lesson.group']}"
                      sortBy="#{lesson.group.name}"
                      filterBy="#{lesson.group.name}"
                      filterMatchMode="contains"
            >
                <h:outputText value="#{lesson.group ne null ? lesson.group.name : msg['label.all.groups']}"/>
            </p:column>
        </p:dataTable>

        <p:contextMenu for="lessons">
            <p:menuitem value="#{msg['option.view']}"
                        update="@([id$=wrapper])"
                        icon="ui-icon-search"
                        actionListener="#{registrationModeBean.initLesson(lessonsBean.selectedLesson)}">
                <f:setPropertyActionListener value="#{false}" target="#{menuBean.showMenu}"/>
                <f:setPropertyActionListener value="registrationMode" target="#{sessionBean.activeView}"/>
            </p:menuitem>
            <p:menuitem value="#{msg['option.edit']}"
                        update=":lessonInfoForm"
                        icon="ui-icon-arrowrefresh-1-w"
                        actionListener="#{lessonBean.initLesson(lessonsBean.selectedLesson)}">
            </p:menuitem>
            <p:menuitem value="#{msg['option.remove']}"
                        update=":lessonsForm"
                        icon="ui-icon-close"
                        styleClass="red"
                        actionListener="#{lessonsBean.removeLesson(lessonsBean.selectedLesson)}">
                <p:confirm header="#{msg['warning']}" message="#{msg['warning.sure.delete']}" icon="ui-icon-alert"/>
            </p:menuitem>
        </p:contextMenu>

        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
            <p:commandButton value="#{msg['label.yes']}" type="button" styleClass="ui-confirmdialog-yes"
                             icon="ui-icon-check"/>
            <p:commandButton value="#{msg['label.no']}" type="button" styleClass="ui-confirmdialog-no"
                             icon="ui-icon-close"/>
        </p:confirmDialog>

    </h:form>
</ui:composition>
